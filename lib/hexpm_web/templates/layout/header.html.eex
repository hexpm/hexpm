<!DOCTYPE html>
<html lang="en" prefix="og: http://ogp.me/ns#">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="<%= description(assigns) %>">
    <meta name="sogou_site_verification" content="GrtyJPARqi"/>

    <title><%= title(assigns) %></title>

    <%= og_tags(assigns) %>
    <%= canonical_url(assigns) %>
    <%= csrf_meta_tag() %>

    <link rel="search" type="application/opensearchdescription+xml" title="Hex" href="/hexsearch.xml">
    <!-- Webpack bundles Bootstrap + Sass into app.css, then Tailwind loads last for highest specificity -->
    <link rel="stylesheet" href="<%= ~p"/assets/app.css" %>">
    <link rel="stylesheet" href="<%= ~p"/assets/tailwind.css" %>">
    <link rel="alternate" type="application/rss+xml" title="RSS - Blog" href="/feeds/blog.xml">

    <%= if host = Application.get_env(:hexpm, :host) do %>
    <script async defer src="https://s.<%= host %>/js/script.js"></script>
    <script>window.plausible=window.plausible||function(){(plausible.q=plausible.q||[]).push(arguments)},plausible.init=plausible.init||function(i){plausible.o=i||{}};plausible.init({endpoint:"https://s.<%= host %>/api/event",captureOnLocalhost:true})</script>
    <% end %>
  </head>
  <body>
    <!--[if lt IE 10]>
      <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="http://browsehappy.com/">upgrade your browser</a> to improve your experience.</p>
    <![endif]-->

    <div class="tw:min-h-dvh tw:flex tw:flex-col">
    <section class="tw:flex tw:flex-1 tw:flex-col">
    <%= render "_read_only_mode.html" %>

    <nav id="main-navbar" class="tw:bg-grey-900 tw:w-full tw:font-sans">
      <div class="tw:max-w-7xl tw:mx-auto tw:px-4">
        <div class="tw:flex tw:items-center tw:justify-between tw:h-[72px] tw:gap-8 tw:lg:gap-20">
          <!-- Logo -->
          <a href="/" class="tw:shrink-0">
            <img src="<%= ~p"/images/hex.png" %>" srcset="<%= ~p"/images/hex.png" %> 1x, <%= ~p"/images/hex@2.png" %> 2x, <%= ~p"/images/hex@3.png" %> 3x" alt="hex logo" class="tw:h-8 tw:w-auto">
          </a>

          <!-- Desktop: Search + Nav + Auth -->
          <div class="tw:hidden tw:lg:flex tw:items-center tw:flex-1 tw:justify-end tw:gap-10">
            <!-- Search Form (only on pages with search) -->
            <%= if show_search?(assigns) do %>
            <form role="search" action="<%= ~p"/packages" %>" class="tw:shrink-0 tw:w-[420px] tw:mr-auto">
              <div class="tw:relative tw:flex tw:items-center">
                <div class="tw:absolute tw:left-3 tw:pointer-events-none">
                  <%= icon(:heroicon, "magnifying-glass", [width: 18, height: 18, class: "tw:text-grey-300"]) %>
                </div>
                <input
                  placeholder="Find packages..."
                  name="search"
                  type="text"
                  class="tw:w-full tw:h-[40px] tw:bg-grey-800 tw:border tw:border-grey-600 tw:rounded-lg tw:px-3 tw:pl-10 tw:py-[11px] tw:text-white tw:leading-4 tw:placeholder:text-grey-300 tw:focus:outline-none tw:focus:border-grey-500 tw:focus:shadow-[inset_0px_0px_6px_0px_rgba(255,255,255,0.3)]"
                  value="<%= search(assigns) %>">
                <input type="hidden" name="sort" value="recent_downloads">
              </div>
            </form>
            <% end %>

            <!-- Nav Links + Auth (always together on the right) -->
            <a href="<%= ~p"/packages" %>" class="tw:text-grey-200 tw:text-md tw:hover:text-white tw:transition-colors">Packages</a>
            <a href="<%= ~p"/pricing" %>" class="tw:text-grey-200 tw:text-md tw:hover:text-white tw:transition-colors">Pricing</a>
            <a href="<%= ~p"/docs" %>" class="tw:text-grey-200 tw:text-md tw:hover:text-white tw:transition-colors">Docs</a>

            <!-- Auth Section -->
            <%= if ViewHelpers.logged_in?(assigns) do %>
              <%= user_dropdown(%{
                avatar_url: ViewHelpers.gravatar_url(User.email(@current_user, :gravatar), :small),
                csrf_token: Plug.CSRFProtection.get_csrf_token(),
                dashboard_path: ~p"/dashboard/profile",
                logout_path: ~p"/logout",
                user_path: ~p"/users/#{@current_user}",
                username: @current_user.username
              }) %>
            <% else %>
              <a href="<%= ~p"/login" %>" class="tw:inline-flex tw:items-center tw:justify-center tw:bg-grey-400 tw:px-6 tw:py-1 tw:rounded-lg tw:text-white tw:text-md tw:hover:bg-grey-500 tw:hover:scale-105 tw:transition-all tw:duration-200">Log In</a>
            <% end %>
          </div>

          <!-- Mobile: Search Icon + User Avatar + Menu -->
          <div class="tw:flex tw:lg:hidden tw:items-center tw:gap-6">
            <%= if ViewHelpers.logged_in?(assigns) do %>
              <img src="<%= ViewHelpers.gravatar_url(User.email(@current_user, :gravatar), :small) %>" class="tw:w-5 tw:h-5 tw:rounded-full" alt="<%= @current_user.username %>">
            <% end %>

            <!-- Mobile Search Toggle -->
            <%= if show_search?(assigns) do %>
              <%= mobile_search_toggle(%{}) %>
            <% end %>

            <!-- Mobile Menu Toggle (HEEx component with Phoenix JS) -->
            <%= mobile_menu_toggle(%{}) %>
          </div>
        </div>

        <!-- Mobile Search Bar (toggled by Phoenix JS) -->
        <%= if show_search?(assigns) do %>
        <div id="mobile-search-bar" class="tw:hidden tw:lg:hidden! tw:bg-grey-900 tw:pb-4">
          <form role="search" action="<%= ~p"/packages" %>">
            <div class="tw:relative">
              <div class="tw:absolute tw:left-3 tw:top-1/2 tw:-translate-y-1/2 tw:pointer-events-none">
                <%= icon(:heroicon, "magnifying-glass", [width: 18, height: 18, class: "tw:text-grey-300"]) %>
              </div>
              <input
                id="mobile-search-input"
                placeholder="Find packages..."
                name="search"
                type="text"
                class="tw:w-full tw:bg-grey-800 tw:border tw:border-grey-600 tw:rounded-lg tw:px-3 tw:pl-10 tw:py-[11px] tw:text-white tw:text-base tw:font-medium tw:leading-4 tw:placeholder:text-grey-300 tw:focus:outline-none tw:focus:border-grey-500 tw:focus:shadow-[inset_0px_0px_6px_0px_rgba(255,255,255,0.3)]"
                value="<%= search(assigns) %>">
              <input type="hidden" name="sort" value="recent_downloads">
            </div>
          </form>
        </div>
        <% end %>

        <!-- Mobile Menu (toggled by Phoenix JS) -->
        <div id="navbar-mobile" class="tw:hidden tw:lg:hidden! tw:bg-grey-900 tw:pb-6">
          <div class="tw:flex tw:flex-col tw:gap-4">
            <a href="<%= ~p"/packages" %>" class="tw:text-grey-200 tw:text-md tw:py-2 tw:hover:text-white">Packages</a>
            <a href="<%= ~p"/pricing" %>" class="tw:text-grey-200 tw:text-md tw:py-2 tw:hover:text-white">Pricing</a>
            <a href="<%= ~p"/docs" %>" class="tw:text-grey-200 tw:text-md tw:py-2 tw:hover:text-white">Docs</a>

            <%= if ViewHelpers.logged_in?(assigns) do %>
              <div class="tw:border-t tw:border-grey-700 tw:pt-4 tw:mt-2">
                <a href="<%= ~p"/users/#{@current_user}" %>" class="tw:block tw:text-grey-200 tw:text-md tw:py-2 tw:hover:text-white">Profile</a>
                <a href="<%= ~p"/dashboard/profile" %>" class="tw:block tw:text-grey-200 tw:text-md tw:py-2 tw:hover:text-white">Dashboard</a>
                <%= form_tag(~p"/logout", class: "tw:mt-2") do %>
                  <button type="submit" class="tw:w-full tw:text-left tw:text-grey-200 tw:text-md tw:py-2 tw:hover:text-white">Log out</button>
                <% end %>
              </div>
            <% else %>
              <a href="<%= ~p"/login" %>" class="tw:bg-grey-600 tw:px-6 tw:py-[11px] tw:rounded-lg tw:text-white tw:text-md tw:text-center tw:hover:bg-grey-500 tw:mt-2">Log In</a>
            <% end %>
          </div>
        </div>
      </div>
    </nav>

    <%= unless assigns[:error] || assigns[:custom_flash] do %>
      <%= render "_flash.html", flash: @flash %>
    <% end %>

    <div class="tw:flex tw:flex-1 tw:flex-col tw:bg-slate-100">
